<mat-table [class]="expandColor" multiTemplateDataRows matSort mat-table [dataSource]="dataSource"
  class="mat-elevation-z2 demo-table w-full">
  <ng-container *ngFor="let column of columns" [matColumnDef]="column.columnDef">
    <mat-header-cell class="font-extrabold" *matHeaderCellDef>
      <span *ngIf="column.type != 'button';else button">
        {{getLabel(column.header) ? getLabel(column.header) : column.header}}
      </span>
      <ng-template #button>
        <button type="button" [color]=" 'primary' "
          (click)="addNewItem()"
          mat-icon-button>
          <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:plus-circle'">
          </mat-icon>
        </button>
      </ng-template>
    </mat-header-cell>



    <mat-cell *matCellDef="let element;">
      <span class="font-semibold" *ngIf="column.dynamic">{{element[column.cell]}}</span>
      <span class="font-semibold" *ngIf="!column.type && !column.dynamic">{{column.cell(element)}}</span>
      <span *ngIf="column.type == 'highlight' && !column.dynamic "
        class="inline-flex items-center font-bold px-2.5 py-0.5 rounded-full tracking-wide uppercase"
        [ngClass]="{'bg-red-200 text-red-800 dark:bg-red-600 dark:text-red-50': column.cellCode(element) == 'warn',
                      'bg-green-200 text-green-800 dark:bg-green-600 dark:text-green-50': column.cellCode(element) == 'success'}">
        <span class="leading-relaxed whitespace-nowrap">{{column.cell(element)}}</span>
      </span>


      <button
        *ngIf="column.type == 'buttonEdit'  && !element[columnKeyRestriction]"
        tabindex="-1" [matTooltip]=" 'Edit'" (click)="$event.stopPropagation(); onButtonEdit(element)" mat-icon-button>
        <mat-icon class="icon-size-4" svgIcon="heroicons_solid:pencil-alt">
        </mat-icon>
      </button>


      <button
        *ngIf="column.type == 'buttonPrint'"
        tabindex="-1" [matTooltip]=" 'print'" (click)="$event.stopPropagation(); onButtonPrint(element)"
        mat-icon-button>
        <mat-icon class="icon-size-4" [svgIcon]=" 'heroicons_solid:printer' ">
        </mat-icon>
      </button>


    </mat-cell>
    <mat-footer-cell class="font-extrabold" *matFooterCellDef> 
      {{(column.columnDef == 'price-with-footer' || column.columnDef == 'total') ? price : column.columnDef == 'days-with-footer' ? timeFrameWithMax : column.columnDef == 'receiptNumber' ? 'Total' : ''}} </mat-footer-cell>
  </ng-container>

  <ng-container matColumnDef="print">
    <mat-header-cell class="font-extrabold" *matHeaderCellDef>
    </mat-header-cell>
    <mat-cell class="p-0" *matCellDef="let element">
      <button tabindex="-1" [matTooltip]=" 'Print'" mat-icon-button [matMenuTriggerFor]="userActions">
        <mat-icon class="icon-size-4" [svgIcon]=" 'heroicons_solid:printer' ">
        </mat-icon>
      </button>
      <mat-menu [xPosition]="'before'" #userActions="matMenu">
        <mat-divider class="my-2"></mat-divider>
        <button *ngFor="let button of printButtons" (click)="print(element,button)" mat-menu-item>
          <span>{{button.name}}</span>
        </button>
      </mat-menu>
    </mat-cell>
  </ng-container>

  <ng-container matColumnDef="printNoMenu">
    <mat-header-cell class="font-extrabold" *matHeaderCellDef>
    </mat-header-cell>
    <mat-cell class="p-0" *matCellDef="let element;">
      <button *ngIf=" (element[columnKeyRestriction] || !columnKeyRestriction)" tabindex="-1" [matTooltip]=" 'Print'"
        (click)="$event.stopPropagation();printDirect(element)" mat-icon-button>
        <mat-icon class="icon-size-4" svgIcon="heroicons_solid:printer">
        </mat-icon>
      </button>
    </mat-cell>
  </ng-container>

  <ng-container matColumnDef="edit">
    <mat-header-cell class="font-extrabold" *matHeaderCellDef>
    </mat-header-cell>
    <mat-cell class="p-0" *matCellDef="let element;">
      <button *ngIf="!element[columnKeyRestriction]" tabindex="-1" [matTooltip]=" 'Edit'"
        (click)="$event.stopPropagation(); editRow(element)" mat-icon-button>
        <mat-icon class="icon-size-4" svgIcon="heroicons_solid:pencil-alt">
        </mat-icon>
      </button>
    </mat-cell>
  </ng-container>

  <ng-container matColumnDef="createTransaction">
    <mat-header-cell class="font-extrabold" *matHeaderCellDef>
    </mat-header-cell>
    <mat-cell class="p-0" *matCellDef="let element;">
      <button *ngIf="!element[columnKeyRestriction]" tabindex="-1" [matTooltip]=" 'Create Transaction'"
      (click)="$event.stopPropagation(); createTransaction(element)" mat-icon-button>
      <mat-icon class="icon-size-4" svgIcon="heroicons_solid:clipboard-copy">
      </mat-icon>
    </button>
    </mat-cell>
  </ng-container>




  <ng-container matColumnDef="downloadPdfs" >
      <mat-header-cell class="font-extrabold" *matHeaderCellDef >
      </mat-header-cell>
      <mat-cell class="p-0" *matCellDef="let element;">
        <button tabindex="-1" [matTooltip]=" 'Download Pdfs'" *ngIf="modules['module_chaletdirectprint']"
          (click)="$event.stopPropagation(); downloadPdfsRow(element)" mat-icon-button>
          <mat-icon class="icon-size-4" svgIcon="heroicons_outline:folder-download">
          </mat-icon>
        </button>
      </mat-cell>
  </ng-container>




  <ng-container matColumnDef="info">
    <mat-header-cell class="font-extrabold" *matHeaderCellDef>
    </mat-header-cell>
    <mat-cell class="p-0" *matCellDef="let element;">
      <button  tabindex="-1" [matTooltip]=" 'Info'"
        (click)="$event.stopPropagation(); infoRow(element)" mat-icon-button>
        <mat-icon class="icon-size-4" svgIcon="heroicons_solid:information-circle">
        </mat-icon>
      </button>
    </mat-cell>
  </ng-container>


  <ng-container matColumnDef="reset">
    <mat-header-cell class="font-extrabold" *matHeaderCellDef>
    </mat-header-cell>
    <mat-cell class="p-0" *matCellDef="let element;">
      <button  tabindex="-1" [matTooltip]=" 'Reset'"
        (click)="$event.stopPropagation(); reset(element)" mat-icon-button>
        <mat-icon class="icon-size-4" svgIcon="heroicons_solid:minus">
        </mat-icon>
      </button>
    </mat-cell>
  </ng-container>


  <ng-container matColumnDef="delete">
    <mat-header-cell class="font-extrabold" *matHeaderCellDef>
    </mat-header-cell>
    <mat-cell class="p-0" *matCellDef="let element;">
      <button *ngIf=" !element[columnKeyRestriction]" tabindex="-1" [matTooltip]=" 'Delete'"
        (click)="$event.stopPropagation(); deleteRow(element)" mat-icon-button>
        <mat-icon class="icon-size-4" svgIcon="heroicons_solid:trash">
        </mat-icon>
      </button>
    </mat-cell>
  </ng-container>



  <ng-container matColumnDef="openDetails">
    <mat-header-cell class="font-extrabold" *matHeaderCellDef>
    </mat-header-cell>
    <mat-cell *matCellDef="let element;">
      <button [matTooltip]=" 'Open Details'" (click)="$event.stopPropagation(); openDetails(element)" mat-icon-button>
        <mat-icon class="icon-size-4" svgIcon="heroicons_outline:arrows-expand">
        </mat-icon>
      </button>
    </mat-cell>
  </ng-container>

  <ng-container matColumnDef="report">
    <mat-header-cell class="font-extrabold" *matHeaderCellDef>
    </mat-header-cell>
    <mat-cell *matCellDef="let element;">
      <button [matTooltip]="getLabel('accessManager')" (click)="$event.stopPropagation();openReport(element)" mat-icon-button>
        <mat-icon class="icon-size-4" svgIcon="heroicons_outline:document-report">
        </mat-icon>
      </button>
    </mat-cell>
  </ng-container>


  <ng-container matColumnDef="add">
    <mat-header-cell class="font-extrabold" *matHeaderCellDef>
    </mat-header-cell>
    <mat-cell *matCellDef="let element;">
      <button *ngIf="element.Ledger_grpdet" tabindex="-1" [matTooltip]="getLabel('addLedger')"
        (click)="$event.stopPropagation(); onAdd(element)" mat-icon-button>
        <mat-icon class="icon-size-6" svgIcon="heroicons_solid:plus">
        </mat-icon>
      </button>
    </mat-cell>
  </ng-container>

  <ng-container matColumnDef="copy">
    <mat-header-cell class="font-extrabold" *matHeaderCellDef>
    </mat-header-cell>
    <mat-cell *matCellDef="let element;">
      <button  tabindex="-1" [matTooltip]=" 'Copy'"
        (click)="$event.stopPropagation(); copyRow(element)" mat-icon-button>
        <mat-icon class="icon-size-4" svgIcon="heroicons_solid:clipboard-copy">
        </mat-icon>
      </button>
    </mat-cell>
  </ng-container>

  <ng-container matColumnDef="reverse">
    <mat-header-cell class="font-extrabold" *matHeaderCellDef>
    </mat-header-cell>
    <mat-cell *matCellDef="let element;">
      <button tabindex="-1" [matTooltip]=" tooltipRefreshIcon "
        (click)="$event.stopPropagation(); reverseRow(element)" mat-icon-button>
        <mat-icon class="icon-size-4" svgIcon="heroicons_solid:refresh">
        </mat-icon>
      </button>
    </mat-cell>
  </ng-container>

  <ng-container matColumnDef="journalCstCheckBill">
    <mat-header-cell class="font-extrabold" *matHeaderCellDef>
    </mat-header-cell>
    <mat-cell *matCellDef="let element;">
      <button tabindex="-1" [matMenuTriggerFor]="menu" type="button" (click)="$event.stopPropagation();"
        mat-icon-button>
        <mat-icon class="icon-size-5 text-grey-500" [svgIcon]="'heroicons_outline:cash'"></mat-icon>
      </button>
      <mat-menu #menu="matMenu">
        <button *ngIf="modules['module_project'] || modules['module_costcenter']
          || modules['module_division1'] || modules['module_division2']"
          (click)="onJournalCstCheckBill(element,'costCenter')" mat-menu-item>
          <span>{{getLabel('details')}}</span>
        </button>
        <button *ngIf="element.Ledger_activity == 1 || element.Ledger_activity == 2"
          (click)="onJournalCstCheckBill(element,'checks')" mat-menu-item>
          <span>{{getLabel('checks')}}</span>
        </button>
        <button *ngIf="element.Ledger_activity == 3 || element.Ledger_activity == 4"
          (click)="onJournalCstCheckBill(element,'bills')" mat-menu-item>
          <span>{{getLabel('bills')}}</span>
        </button>
      </mat-menu>
    </mat-cell>
  </ng-container>

  <ng-container matColumnDef="goTo">
    <mat-header-cell class="font-extrabold" *matHeaderCellDef>
    </mat-header-cell>
    <mat-cell *matCellDef="let element;">
      <button tabindex="-1" *ngIf="element[goToData.key] != null" [matTooltip]=" goToData.tooltip"
        (click)="$event.stopPropagation(); goToPage(element)" mat-icon-button>
        <mat-icon class="icon-size-4" svgIcon="heroicons_outline:arrow-circle-right">
        </mat-icon>
      </button>
    </mat-cell>
  </ng-container>

  <ng-container matColumnDef="upload">
    <mat-header-cell class="font-extrabold" *matHeaderCellDef>
    </mat-header-cell>
    <mat-cell class="p-0" *matCellDef="let element;">
      <button tabindex="-1" [matTooltip]=" 'Upload'" (click)="$event.stopPropagation(); onUploadDocument(element)"
        mat-icon-button>
        <mat-icon class="icon-size-4" svgIcon="mat_outline:attach_file">
        </mat-icon>
      </button>
    </mat-cell>
  </ng-container>



  <ng-container matColumnDef="img">
    <mat-header-cell class="font-extrabold" *matHeaderCellDef>
    </mat-header-cell>
    <mat-cell class="p-0" *matCellDef="let element;">
      <button tabindex="-1" [matTooltip]=" 'Image'" (click)="$event.stopPropagation(); onImageDocument(element)"
        mat-icon-button>
        <mat-icon class="icon-size-4" svgIcon="heroicons_outline:photograph">
        </mat-icon>
      </button>
    </mat-cell>
  </ng-container>



  <ng-container matColumnDef="viewStatement">
    <mat-header-cell class="font-extrabold" *matHeaderCellDef>
    </mat-header-cell>
    <mat-cell class="p-0" *matCellDef="let element;">
      <button tabindex="-1" *ngIf="!element.Ledger_grpdet"[matTooltip]=" 'View Statement'" (click)="$event.stopPropagation(); onViewStament(element)"
        mat-icon-button>
        <mat-icon class="icon-size-4" svgIcon="remove_red_eye">
        </mat-icon>
      </button>
    </mat-cell>
  </ng-container>




  <ng-container matColumnDef="request">
    <mat-header-cell class="font-extrabold" *matHeaderCellDef>
    </mat-header-cell>
    <mat-cell class="p-0" *matCellDef="let element;">
      <button tabindex="-1" [matTooltip]=" 'Print Card'" (click)="$event.stopPropagation(); request(element)"
      *ngIf="!modules['module_chaletdirectprint']"
        mat-icon-button>
        <mat-icon class="icon-size-4" svgIcon="heroicons_outline:credit-card">
        </mat-icon>
      </button>
    </mat-cell>
  </ng-container>

  <ng-container matColumnDef="selectable">
    <mat-header-cell class="font-extrabold" *matHeaderCellDef>
         <span *ngIf="checkboxLabel">
        {{getLabel(checkboxLabel.label)}}
      </span>
    </mat-header-cell>
    <mat-cell *matCellDef="let element;">
      <mat-checkbox
      (click)="$event.stopPropagation()"
      [checked]="selection.isSelected(element) || (checkboxLabel != null ? element[checkboxLabel.key] : false)"
      (change)="startRowSelection(element);">
      </mat-checkbox>
    </mat-cell>
    <mat-footer-cell class="font-extrabold" *matFooterCellDef> Total </mat-footer-cell>
  </ng-container>

  <ng-container matColumnDef="selectable-no-model">
    <mat-header-cell class="font-extrabold" *matHeaderCellDef>
      <mat-checkbox
        (click)="$event.stopPropagation()"
        (change)="allSelection($event.checked);">
      </mat-checkbox>
    </mat-header-cell>
    <mat-cell *matCellDef="let element;">
      <mat-checkbox
      (click)="$event.stopPropagation()"
      [checked]="(checkboxLabel != null ? element[checkboxLabel.key] : false)"
      (change)="updateSelectionInArray(element,$event.checked);">
      </mat-checkbox>
    </mat-cell>
    <mat-footer-cell class="font-extrabold" *matFooterCellDef> Total </mat-footer-cell>
  </ng-container>




  <ng-container matColumnDef="expand">
    <mat-header-cell class="font-extrabold" *matHeaderCellDef>
    </mat-header-cell>
    <mat-cell *matCellDef="let element; let rowIndex = dataIndex">
      <button *ngIf="element.expandedDetails.length > 0" tabindex="-1" mat-icon-button aria-label="expand row"
        (click)="$event.stopPropagation();onExpandSelection(element,rowIndex)">
        <mat-icon *ngIf="expandedElement === element">
          keyboard_arrow_up</mat-icon>
        <mat-icon *ngIf="expandedElement !== element">
          keyboard_arrow_down
        </mat-icon>
      </button>
    </mat-cell>
  </ng-container>

  <ng-container *ngFor="let header of initialHeaderColumns" [matColumnDef]="header.columnDef">
    <mat-header-cell class="justify-center font-extrabold p-0" [colspan]="header.colspan" *matHeaderCellDef>
      {{getLabel(header.label)}}</mat-header-cell>
  </ng-container>

  <!-- <ng-container matColumnDef="ledgerNumberDebitFirst">
    <mat-header-cell colspan="2" class="justify-center font-extrabold" *matHeaderCellDef>{{getLabel('debit')}}
    </mat-header-cell>
  </ng-container>

  <ng-container matColumnDef="ledgerNameDebitFirst">
    <mat-header-cell *matHeaderCellDef></mat-header-cell>
  </ng-container>

  <ng-container matColumnDef="ledgerNumberCreditFirst">
    <mat-header-cell colspan="2" class="justify-center font-extrabold" *matHeaderCellDef>{{getLabel('credit')}}
    </mat-header-cell>
  </ng-container>

  <ng-container matColumnDef="ledgerNameCreditFirst">
    <mat-header-cell *matHeaderCellDef></mat-header-cell>
  </ng-container> -->

  <ng-container matColumnDef="expandedDetail">
    <mat-cell class="bg-gray-200 dark:bg-gray-800" *matCellDef="let element;let rowIndex = dataIndex"
      [attr.colspan]="columns.length">
      <div *ngIf="expandedElement && rowIndex == indexOfExpand" class="example-element-detail"
        [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">
        <app-erp-grid-expand [initialHeaderColumns]="initialHeaderColumns"
          [initialHeaderColumnsDef]="initialHeaderColumnsDef" [hasInitialHeader]="true"
          (onClickButtonPrintExpand)="onClickExpandButtonPrint($event)"
          (onClickButtonEditExpand)="onClickExpandButtonEdit($event)"
          (journalCstCheckBillEventExpand)="onExpandCstCheckBillSelection($event)"
          [columnsExpandButtons]="columnsExpandButtons" #expandedTable [columnsExpand]="columnsExpand">
        </app-erp-grid-expand>
      </div>
    </mat-cell>
  </ng-container>

  <ng-container *ngIf="hasInitialHeader">
    <mat-header-row style="border-bottom: none;" class="shadow text-md bg-gray-200"
      *matHeaderRowDef="initialHeaderColumnsDef">
    </mat-header-row>
  </ng-container>

  <mat-header-row [class]="expandColor" class="shadow font-semibold text-md bg-gray-50"
    *matHeaderRowDef="buttons.concat(displayedColumns.concat(endButtons)); sticky : true;">
  </mat-header-row>
  <mat-row [ngClass]="{'bg-gray-200':selectedElement == element}" (click)="rowClick && editRow(element)"
    (dblclick)="doubleClickLineOption && onSelectElement(element)" class="cursor-pointer dark:hover:bg-hover"
    *matRowDef="let element; columns: buttons.concat(displayedColumns.concat(endButtons));">
  </mat-row>
  <mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></mat-row>

  <ng-container *ngIf="withFooter">
    <mat-footer-row *matFooterRowDef="footerCols; sticky: true"></mat-footer-row >
  </ng-container>
  

</mat-table>
